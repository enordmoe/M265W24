<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="E Nordmoe">

<title>Getting Started with GitHub and RStudio Server</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/clipboard/clipboard.min.js"></script>
<script src="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/quarto-html/quarto.js"></script>
<script src="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/quarto-html/popper.min.js"></script>
<script src="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/quarto-html/anchor.min.js"></script>
<link href="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Getting_Started_with_GitHub_and_RStudio_Server_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Getting Started with GitHub and RStudio Server</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>E Nordmoe </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>What follows is a step by step path for getting the GitHub-RStudio Server connection up and running.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<section id="create-github-account" class="level2">
<h2 class="anchored" data-anchor-id="create-github-account">1. Create GitHub account</h2>
<p>This should be completed already. If not, refer to the <a href="https://kzoo-my.sharepoint.com/:v:/g/personal/eric_nordmoe_kzoo_edu/EQ0fBJNc8f9LuWEeJP-n754Bmk4hi3bukwUfw18a64Mi1g?e=t0uguP&amp;nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJTdHJlYW1XZWJBcHAiLCJyZWZlcnJhbFZpZXciOiJTaGFyZURpYWxvZy1MaW5rIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXcifX0%3D">screencast</a> posted earlier.</p>
</section>
<section id="create-a-new-repository-with-only-readme.md" class="level2">
<h2 class="anchored" data-anchor-id="create-a-new-repository-with-only-readme.md">2. Create a New Repository with only README.md</h2>
<p>Log in to your GitHub account from a browser at github.com. At the dashboard, click the green “Create repository” button. Or, if you are on your own profile page, click on “Repositories”, then click the green “New” button.</p>
<p>How to fill this in:</p>
<ul>
<li><p>Repository name: <strong>myrepo</strong> (or whatever you wish, we’ll delete this soon anyway).</p></li>
<li><p>Description: “Testing my setup” (or whatever, but some text is good for the README).</p></li>
<li><p>Public.</p></li>
<li><p>Click on the box to “Initialize this repository with” “Add a README file.”</p></li>
</ul>
<p>For everything else, just accept the default.</p>
<p>Click the green “Create repository” button at the lower right.</p>
</section>
<section id="log-into-your-account-on-rstudio.kzoo.edu" class="level2">
<h2 class="anchored" data-anchor-id="log-into-your-account-on-rstudio.kzoo.edu">3. Log into your account on rstudio.kzoo.edu</h2>
<p>Use your KNET user name and password as instructed at the login page.</p>
</section>
<section id="configure-rstudio-with-your-name-and-email-used-for-github" class="level2">
<h2 class="anchored" data-anchor-id="configure-rstudio-with-your-name-and-email-used-for-github">4. Configure RStudio with your Name and email used for GitHub</h2>
<p>Before running this, be sure to replace the text shown with your username and the email you used for your GitHub account.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(usethis)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">use_git_config</span>(<span class="at">user.name =</span> <span class="st">"Demo Student1"</span>, <span class="at">user.email =</span> <span class="st">"kxxed01@protonmail.com"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-credentials-in-rstudio" class="level2">
<h2 class="anchored" data-anchor-id="set-credentials-in-rstudio">5. Set credentials in RStudio</h2>
<section id="create-and-store-your-personal-access-token-pat" class="level3">
<h3 class="anchored" data-anchor-id="create-and-store-your-personal-access-token-pat">Create and store your personal access token (PAT)</h3>
<p>The personal access token (PAT) is used when interfacing with the GitHub repository. It identifies you to GitHub and, if stored (cached) properly, should not have to be entered each time you push an update to a repository.</p>
<p>Use the following commands to create your PAT. You must <strong>store this token somewhere</strong>, because you’ll never be able to see it again, once you leave this browser window. (If you somehow run into troubles with this or forget your PAT, just generate a new PAT and, so you don’t confuse yourself, delete the lost PAT token.)</p>
<p>The <strong>usethis</strong> package has a helper function <code>create_github_token()</code> that takes you to the web form to create a PAT, with the added benefit that it pre-selects the recommended “scopes.” Use these commands at the R command line. When taken to GitHub, create your Personal Access Token and copy it (save it somewhere as mentioned above!). Accept the defaults except I recommend for the purpose of this course that you set the expiration for your PAT to be <strong>custom</strong> and pick a date sometime after the end of winter term so it doesn’t expire just as you’re trying to complete an assignment. If you use a password management app, this is a great time to add your PAT to the entry for GitHub.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the library usethis should have been loaded above</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Running the following will take you to GitHub to create your PAT</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">create_github_token</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point, I assume you’ve created a PAT and have it available on your clipboard.</p>
</section>
<section id="put-your-pat-into-the-git-credential-store" class="level3">
<h3 class="anchored" data-anchor-id="put-your-pat-into-the-git-credential-store">Put your PAT into the Git credential store</h3>
<p>There is another package called <strong>gitcreds</strong> that will help to save your credentials including the PAT so you shouldn’t have to enter it every time you push to or pull from the GitHub repository.</p>
<p>Enter the following at the command line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gitcreds<span class="sc">::</span><span class="fu">gitcreds_set</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you don’t have a PAT stored already, it will prompt you to enter your PAT. Paste it in!</p>
<p>If you already have a stored credential, <code>gitcreds::gitcreds_set()</code> reveals this and will even let you inspect it. This helps you decide whether to keep the existing credential or replace it. When in doubt, embrace a new, known-to-be-good credential over an old one, of uncertain origins.</p>
</section>
<section id="check-your-credentials" class="level3">
<h3 class="anchored" data-anchor-id="check-your-credentials">Check your credentials</h3>
<p>Use the following to check that everything worked:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">git_sitrep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function shows whether a GitHub PAT is discovered and provides information about the associated user, the PAT’s scopes, etc. You may see some red marks but a key point is whether the token is “discovered” as shown in the figure below.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/sitrep_out.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>This step is something you do once per PAT when using RStudio server. From this point on, <code>usethis</code> and its dependencies should be able to automatically retrieve and use this PAT.</p>
<p>Be sure to keep your RStudio session open during the steps that follow.</p>
</section>
</section>
<section id="clone-the-new-repository-to-your-rstudio-server-account" class="level2">
<h2 class="anchored" data-anchor-id="clone-the-new-repository-to-your-rstudio-server-account">6. Clone the new repository to your RStudio Server account</h2>
<ol type="1">
<li><p>Go to the new <strong>myrepo</strong> repository on your github.com account.</p></li>
<li><p>Copy the HTTPS clone URL to your clipboard via the green “Code” button.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/clone_url.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Go back to RStudio (rstudio.kzoo.edu).</li>
</ol>
<p>In RStudio, start a new Project as follows:</p>
<ul>
<li><p><em>File &gt; New Project &gt; Version Control &gt; Git</em>. In “Repository URL”, paste the URL of your new GitHub repository. It will be something like this <code>https://github.com/kxxed01/myrepo.git</code> .</p></li>
<li><p>Hit the TAB key and accept the default project directory name, e.g.&nbsp;<strong>myrepo</strong>, which coincides with the GitHub repo name (or type it in if necessary).</p></li>
<li><p>Take charge of— or at least notice!—where the Project will be saved. A common mistake is to have no idea where you are saving files or what your working directory is. The “tilde” character ‘~’ represents “home” so I suggest you use <code>~/tmp</code> so that the project is in a temporary folder since we’re really not going to do anything much with it. In the future, you may wish to save your projects in a <code>projects</code> or <code>homework</code> folder.</p></li>
<li><p>Check “Open in new session”, as that’s what you’ll usually do in practice.</p></li>
<li><p>Click “Create Project”</p></li>
</ul>
<p>You should find yourself in a new local RStudio Project that represents the new test repo we just created on GitHub. This should download the <code>README.md</code> file from GitHub. Look in RStudio’s file browser pane for the <code>README.md</code> file.</p>
</section>
<section id="make-local-changes-save-commit" class="level2">
<h2 class="anchored" data-anchor-id="make-local-changes-save-commit">7. Make local changes, save, commit</h2>
<p>From RStudio, modify the <code>README.md</code> file, e.g., by adding the line “This is a line from RStudio”. Save your changes.</p>
<p>Commit these changes to your local repo. How?</p>
<p>From RStudio:</p>
<ul>
<li><p>Click the “Git” tab in the upper right pane.</p></li>
<li><p>Click the Commit button at the top of the Git pane to open the Review Changes window.</p></li>
<li><p>Check the “Staged” box for <code>README.md</code>. This should put a check mark in front of the file.</p></li>
<li><p>Enter a Commit message such as “My first commit from RStudio.” Then click on the button Commit to actually commit the changes. Don’t close the Review Changes window yet. Move on to step 8 below…</p></li>
</ul>
</section>
<section id="push-your-local-changes-online-to-github" class="level2">
<h2 class="anchored" data-anchor-id="push-your-local-changes-online-to-github">8. Push your local changes online to GitHub</h2>
<p>Click the green “Push” arrow button in the upper right of the Review Changes window to send your local changes to GitHub. If you are challenged for username and password, provide them but for your password, you should paste in the PAT created earlier. You should see some message along these lines.</p>
<pre><code>[master dc671f0] blah
 3 files changed, 22 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 myrepo.Rproj</code></pre>
</section>
<section id="confirm-the-local-change-propagated-to-the-github-remote" class="level2">
<h2 class="anchored" data-anchor-id="confirm-the-local-change-propagated-to-the-github-remote">9. Confirm the local change propagated to the GitHub remote</h2>
<p>Go back to the browser. I assume you’re still viewing your new GitHub repo.</p>
<p>Reload the web page to refresh the display.</p>
<p>You should see the new “This is a line from RStudio” in the README on the <strong>myrepo</strong> page .</p>
<p>If you click on “commits”, you should see one with the message “Commit from RStudio” or whatever you entered as your commit message.</p>
<p>If you have made it this far, you are DONE with set up. But let me know if you were challenged for the GitHub username and password when you pushed to the repository.</p>
</section>
<section id="congratulations" class="level2">
<h2 class="anchored" data-anchor-id="congratulations">10. Congratulations!</h2>
<p>If you got this far, you’ve already accomplished a lot and will be well prepared to start carrying out assignments in RStudio that you can share with me for feedback via GitHub.</p>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Document adapted from <a href="https://happygitwithr.com" class="uri">https://happygitwithr.com</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>